'use strict';

var Q = require('q');
var Goal = require('../schema/goal.js');
var utility = require('../utility/utility-func.js');

var createGoalItem = Q.nbind(Goal.create, Goal);
var findGoalItems = Q.nbind(Goal.find, Goal);
var updateGoalItems = Q.nbind(Goal.update, Goal);
var removeGoalItems = Q.nbind(Goal.remove, Goal);

module.exports = {

  addToGoals: function addToGoals(req, res, next) {

    var newGoalItem = {
      userId: req.body.userId,
      user: req.body.user,
      task: req.body.task,
      completed: false
    };

    createGoalItem(newGoalItem).then(function (data) {
      console.log('New goal item saved!');
      return res.status(201).json(data);
    }).fail(function (err) {
      console.error('Goal item could not be saved, try again noob');
      console.error(err);
      return res.status(404).end();
    });
  },

  getAllGoals: function getAllGoals(req, res, next) {

    findGoalItems({ completed: false }).then(function (goalItems) {
      return goalItems.reverse();
    }).then(function (goalItems) {
      return res.status(200).json(goalItems);
    }).catch(function (error) {
      console.error('Goal items could not be retrieved');
      return res.status(404).end();
    });
  },

  toggleCompletion: function toggleCompletion(req, res, next) {

    updateGoalItems({ _id: req.body._id }, { completed: req.body.completed }, {}).then(function (listItem) {
      console.log('List item updated');
      return res.status(202).end();
    }).catch(function (err) {
      console.log('List item update failed');
      return res.status(404).end();
    });
  },

  deleteGoals: function deleteGoals(req, res, next) {
    removeGoalItems({ _id: req.body._id }).then(function () {
      console.log('Item removed');
      return res.status(200).end();
    }).catch(function (err) {
      console.error('Item could not be removed');
      return res.status(404).end();
    });
  },

  getCompleted: function getCompleted(req, res, next) {

    findGoalItems({ completed: true }).then(function (goalItems) {
      return goalItems.reverse();
    }).then(function (goalItems) {
      return res.status(200).json(goalItems);
    }).catch(function (error) {
      console.error('List items could not be retrieved');
      return res.status(404).end();
    });
  },

  updateDescription: function updateDescription(req, res, next) {

    updateGoalItems({ _id: req.body._id }, { task: req.body.task, description: req.body.description }, {}).then(function (goalItem) {
      console.log('Goal description updated');
      return res.status(202).end();
    }).catch(function (err) {
      console.log('Goal description update failed');
      return res.status(404).end();
    });
  }

};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NvbnRyb2xsZXJzL2dvYWxDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbIlEiLCJyZXF1aXJlIiwiR29hbCIsInV0aWxpdHkiLCJjcmVhdGVHb2FsSXRlbSIsIm5iaW5kIiwiY3JlYXRlIiwiZmluZEdvYWxJdGVtcyIsImZpbmQiLCJ1cGRhdGVHb2FsSXRlbXMiLCJ1cGRhdGUiLCJyZW1vdmVHb2FsSXRlbXMiLCJyZW1vdmUiLCJtb2R1bGUiLCJleHBvcnRzIiwiYWRkVG9Hb2FscyIsInJlcSIsInJlcyIsIm5leHQiLCJuZXdHb2FsSXRlbSIsInVzZXJJZCIsImJvZHkiLCJ1c2VyIiwidGFzayIsImNvbXBsZXRlZCIsInRoZW4iLCJkYXRhIiwiY29uc29sZSIsImxvZyIsInN0YXR1cyIsImpzb24iLCJmYWlsIiwiZXJyIiwiZXJyb3IiLCJlbmQiLCJnZXRBbGxHb2FscyIsImdvYWxJdGVtcyIsInJldmVyc2UiLCJjYXRjaCIsInRvZ2dsZUNvbXBsZXRpb24iLCJfaWQiLCJsaXN0SXRlbSIsImRlbGV0ZUdvYWxzIiwiZ2V0Q29tcGxldGVkIiwidXBkYXRlRGVzY3JpcHRpb24iLCJkZXNjcmlwdGlvbiIsImdvYWxJdGVtIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLElBQUlDLFFBQVEsR0FBUixDQUFSO0FBQ0EsSUFBSUMsT0FBT0QsUUFBUSxtQkFBUixDQUFYO0FBQ0EsSUFBSUUsVUFBVUYsUUFBUSw0QkFBUixDQUFkOztBQUVBLElBQUlHLGlCQUFpQkosRUFBRUssS0FBRixDQUFRSCxLQUFLSSxNQUFiLEVBQXFCSixJQUFyQixDQUFyQjtBQUNBLElBQUlLLGdCQUFnQlAsRUFBRUssS0FBRixDQUFRSCxLQUFLTSxJQUFiLEVBQW1CTixJQUFuQixDQUFwQjtBQUNBLElBQUlPLGtCQUFrQlQsRUFBRUssS0FBRixDQUFRSCxLQUFLUSxNQUFiLEVBQXFCUixJQUFyQixDQUF0QjtBQUNBLElBQUlTLGtCQUFrQlgsRUFBRUssS0FBRixDQUFRSCxLQUFLVSxNQUFiLEVBQXFCVixJQUFyQixDQUF0Qjs7QUFFQVcsT0FBT0MsT0FBUCxHQUFpQjs7QUFFZkMsY0FBWSxvQkFBU0MsR0FBVCxFQUFjQyxHQUFkLEVBQW1CQyxJQUFuQixFQUF5Qjs7QUFFbkMsUUFBTUMsY0FBYztBQUNsQkMsY0FBUUosSUFBSUssSUFBSixDQUFTRCxNQURDO0FBRWxCRSxZQUFNTixJQUFJSyxJQUFKLENBQVNDLElBRkc7QUFHbEJDLFlBQU1QLElBQUlLLElBQUosQ0FBU0UsSUFIRztBQUlsQkMsaUJBQVc7QUFKTyxLQUFwQjs7QUFPQXBCLG1CQUFlZSxXQUFmLEVBQ0NNLElBREQsQ0FDTSxVQUFDQyxJQUFELEVBQVU7QUFDZEMsY0FBUUMsR0FBUixDQUFZLHNCQUFaO0FBQ0EsYUFBT1gsSUFBSVksTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCSixJQUFyQixDQUFQO0FBQ0QsS0FKRCxFQUtDSyxJQUxELENBS00sVUFBQ0MsR0FBRCxFQUFTO0FBQ2JMLGNBQVFNLEtBQVIsQ0FBYyw4Q0FBZDtBQUNBTixjQUFRTSxLQUFSLENBQWNELEdBQWQ7QUFDQSxhQUFPZixJQUFJWSxNQUFKLENBQVcsR0FBWCxFQUFnQkssR0FBaEIsRUFBUDtBQUNELEtBVEQ7QUFVRCxHQXJCYzs7QUF1QmZDLGVBQWEscUJBQVNuQixHQUFULEVBQWNDLEdBQWQsRUFBbUJDLElBQW5CLEVBQXlCOztBQUVwQ1gsa0JBQWMsRUFBQ2lCLFdBQVcsS0FBWixFQUFkLEVBQ0NDLElBREQsQ0FDTSxVQUFDVyxTQUFELEVBQWU7QUFDbkIsYUFBT0EsVUFBVUMsT0FBVixFQUFQO0FBQ0QsS0FIRCxFQUlDWixJQUpELENBSU0sVUFBQ1csU0FBRCxFQUFlO0FBQ25CLGFBQU9uQixJQUFJWSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUJNLFNBQXJCLENBQVA7QUFDRCxLQU5ELEVBT0NFLEtBUEQsQ0FPTyxVQUFDTCxLQUFELEVBQVc7QUFDaEJOLGNBQVFNLEtBQVIsQ0FBYyxtQ0FBZDtBQUNBLGFBQU9oQixJQUFJWSxNQUFKLENBQVcsR0FBWCxFQUFnQkssR0FBaEIsRUFBUDtBQUNELEtBVkQ7QUFXRCxHQXBDYzs7QUFzQ2ZLLG9CQUFrQiwwQkFBU3ZCLEdBQVQsRUFBY0MsR0FBZCxFQUFtQkMsSUFBbkIsRUFBeUI7O0FBRXpDVCxvQkFBZ0IsRUFBQytCLEtBQUt4QixJQUFJSyxJQUFKLENBQVNtQixHQUFmLEVBQWhCLEVBQXFDLEVBQUNoQixXQUFXUixJQUFJSyxJQUFKLENBQVNHLFNBQXJCLEVBQXJDLEVBQXNFLEVBQXRFLEVBQ0NDLElBREQsQ0FDTSxVQUFDZ0IsUUFBRCxFQUFjO0FBQ2xCZCxjQUFRQyxHQUFSLENBQVksbUJBQVo7QUFDQSxhQUFPWCxJQUFJWSxNQUFKLENBQVcsR0FBWCxFQUFnQkssR0FBaEIsRUFBUDtBQUNELEtBSkQsRUFLQ0ksS0FMRCxDQUtPLFVBQUNOLEdBQUQsRUFBUztBQUNkTCxjQUFRQyxHQUFSLENBQVkseUJBQVo7QUFDQSxhQUFPWCxJQUFJWSxNQUFKLENBQVcsR0FBWCxFQUFnQkssR0FBaEIsRUFBUDtBQUNELEtBUkQ7QUFTRCxHQWpEYzs7QUFtRGZRLGVBQWEscUJBQVMxQixHQUFULEVBQWNDLEdBQWQsRUFBbUJDLElBQW5CLEVBQXlCO0FBQ3BDUCxvQkFBZ0IsRUFBQzZCLEtBQUt4QixJQUFJSyxJQUFKLENBQVNtQixHQUFmLEVBQWhCLEVBQ0NmLElBREQsQ0FDTSxZQUFNO0FBQ1ZFLGNBQVFDLEdBQVIsQ0FBWSxjQUFaO0FBQ0EsYUFBT1gsSUFBSVksTUFBSixDQUFXLEdBQVgsRUFBZ0JLLEdBQWhCLEVBQVA7QUFDRCxLQUpELEVBS0NJLEtBTEQsQ0FLTyxVQUFDTixHQUFELEVBQVM7QUFDZEwsY0FBUU0sS0FBUixDQUFjLDJCQUFkO0FBQ0EsYUFBT2hCLElBQUlZLE1BQUosQ0FBVyxHQUFYLEVBQWdCSyxHQUFoQixFQUFQO0FBQ0QsS0FSRDtBQVNELEdBN0RjOztBQStEZlMsZ0JBQWMsc0JBQVMzQixHQUFULEVBQWNDLEdBQWQsRUFBbUJDLElBQW5CLEVBQXlCOztBQUVyQ1gsa0JBQWMsRUFBQ2lCLFdBQVcsSUFBWixFQUFkLEVBQ0NDLElBREQsQ0FDTSxVQUFDVyxTQUFELEVBQWU7QUFDbkIsYUFBT0EsVUFBVUMsT0FBVixFQUFQO0FBQ0QsS0FIRCxFQUlDWixJQUpELENBSU0sVUFBQ1csU0FBRCxFQUFlO0FBQ25CLGFBQU9uQixJQUFJWSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUJNLFNBQXJCLENBQVA7QUFDRCxLQU5ELEVBT0NFLEtBUEQsQ0FPTyxVQUFDTCxLQUFELEVBQVc7QUFDaEJOLGNBQVFNLEtBQVIsQ0FBYyxtQ0FBZDtBQUNBLGFBQU9oQixJQUFJWSxNQUFKLENBQVcsR0FBWCxFQUFnQkssR0FBaEIsRUFBUDtBQUNELEtBVkQ7QUFXRCxHQTVFYzs7QUE4RWZVLHFCQUFtQiwyQkFBUzVCLEdBQVQsRUFBY0MsR0FBZCxFQUFtQkMsSUFBbkIsRUFBeUI7O0FBRTFDVCxvQkFBZ0IsRUFBQytCLEtBQUt4QixJQUFJSyxJQUFKLENBQVNtQixHQUFmLEVBQWhCLEVBQXFDLEVBQUNqQixNQUFNUCxJQUFJSyxJQUFKLENBQVNFLElBQWhCLEVBQXNCc0IsYUFBYTdCLElBQUlLLElBQUosQ0FBU3dCLFdBQTVDLEVBQXJDLEVBQStGLEVBQS9GLEVBQ0NwQixJQURELENBQ00sVUFBQ3FCLFFBQUQsRUFBYztBQUNsQm5CLGNBQVFDLEdBQVIsQ0FBWSwwQkFBWjtBQUNBLGFBQU9YLElBQUlZLE1BQUosQ0FBVyxHQUFYLEVBQWdCSyxHQUFoQixFQUFQO0FBQ0QsS0FKRCxFQUtDSSxLQUxELENBS08sVUFBQ04sR0FBRCxFQUFTO0FBQ2RMLGNBQVFDLEdBQVIsQ0FBWSxnQ0FBWjtBQUNBLGFBQU9YLElBQUlZLE1BQUosQ0FBVyxHQUFYLEVBQWdCSyxHQUFoQixFQUFQO0FBQ0QsS0FSRDtBQVNEOztBQXpGYyxDQUFqQiIsImZpbGUiOiJnb2FsQ29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBRID0gcmVxdWlyZSgncScpO1xudmFyIEdvYWwgPSByZXF1aXJlKCcuLi9zY2hlbWEvZ29hbC5qcycpO1xudmFyIHV0aWxpdHkgPSByZXF1aXJlKCcuLi91dGlsaXR5L3V0aWxpdHktZnVuYy5qcycpO1xuXG52YXIgY3JlYXRlR29hbEl0ZW0gPSBRLm5iaW5kKEdvYWwuY3JlYXRlLCBHb2FsKTtcbnZhciBmaW5kR29hbEl0ZW1zID0gUS5uYmluZChHb2FsLmZpbmQsIEdvYWwpO1xudmFyIHVwZGF0ZUdvYWxJdGVtcyA9IFEubmJpbmQoR29hbC51cGRhdGUsIEdvYWwpO1xudmFyIHJlbW92ZUdvYWxJdGVtcyA9IFEubmJpbmQoR29hbC5yZW1vdmUsIEdvYWwpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgXG4gIGFkZFRvR29hbHM6IGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XG4gICAgXG4gICAgY29uc3QgbmV3R29hbEl0ZW0gPSB7XG4gICAgICB1c2VySWQ6IHJlcS5ib2R5LnVzZXJJZCxcbiAgICAgIHVzZXI6IHJlcS5ib2R5LnVzZXIsXG4gICAgICB0YXNrOiByZXEuYm9keS50YXNrLFxuICAgICAgY29tcGxldGVkOiBmYWxzZVxuICAgIH07XG5cbiAgICBjcmVhdGVHb2FsSXRlbShuZXdHb2FsSXRlbSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ05ldyBnb2FsIGl0ZW0gc2F2ZWQhJyk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDEpLmpzb24oZGF0YSk7XG4gICAgfSlcbiAgICAuZmFpbCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKCdHb2FsIGl0ZW0gY291bGQgbm90IGJlIHNhdmVkLCB0cnkgYWdhaW4gbm9vYicpO1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5lbmQoKTsgIFxuICAgIH0pO1xuICB9LFxuXG4gIGdldEFsbEdvYWxzOiBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICAgIFxuICAgIGZpbmRHb2FsSXRlbXMoe2NvbXBsZXRlZDogZmFsc2V9KVxuICAgIC50aGVuKChnb2FsSXRlbXMpID0+IHtcbiAgICAgIHJldHVybiBnb2FsSXRlbXMucmV2ZXJzZSgpO1xuICAgIH0pXG4gICAgLnRoZW4oKGdvYWxJdGVtcykgPT4ge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKGdvYWxJdGVtcyk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKCdHb2FsIGl0ZW1zIGNvdWxkIG5vdCBiZSByZXRyaWV2ZWQnKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuZW5kKCk7XG4gICAgfSk7XG4gIH0sXG5cbiAgdG9nZ2xlQ29tcGxldGlvbjogZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHtcbiAgICBcbiAgICB1cGRhdGVHb2FsSXRlbXMoe19pZDogcmVxLmJvZHkuX2lkfSwge2NvbXBsZXRlZDogcmVxLmJvZHkuY29tcGxldGVkfSwge30pXG4gICAgLnRoZW4oKGxpc3RJdGVtKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnTGlzdCBpdGVtIHVwZGF0ZWQnKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMikuZW5kKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ0xpc3QgaXRlbSB1cGRhdGUgZmFpbGVkJyk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmVuZCgpO1xuICAgIH0pO1xuICB9LFxuXG4gIGRlbGV0ZUdvYWxzOiBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICAgIHJlbW92ZUdvYWxJdGVtcyh7X2lkOiByZXEuYm9keS5faWR9KVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdJdGVtIHJlbW92ZWQnKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuZW5kKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcignSXRlbSBjb3VsZCBub3QgYmUgcmVtb3ZlZCcpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5lbmQoKTtcbiAgICB9KTtcbiAgfSxcblxuICBnZXRDb21wbGV0ZWQ6IGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XG4gICAgXG4gICAgZmluZEdvYWxJdGVtcyh7Y29tcGxldGVkOiB0cnVlfSlcbiAgICAudGhlbigoZ29hbEl0ZW1zKSA9PiB7XG4gICAgICByZXR1cm4gZ29hbEl0ZW1zLnJldmVyc2UoKTtcbiAgICB9KVxuICAgIC50aGVuKChnb2FsSXRlbXMpID0+IHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihnb2FsSXRlbXMpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcignTGlzdCBpdGVtcyBjb3VsZCBub3QgYmUgcmV0cmlldmVkJyk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmVuZCgpO1xuICAgIH0pO1xuICB9LFxuXG4gIHVwZGF0ZURlc2NyaXB0aW9uOiBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuXG4gICAgdXBkYXRlR29hbEl0ZW1zKHtfaWQ6IHJlcS5ib2R5Ll9pZH0sIHt0YXNrOiByZXEuYm9keS50YXNrLCBkZXNjcmlwdGlvbjogcmVxLmJvZHkuZGVzY3JpcHRpb259LCB7fSlcbiAgICAudGhlbigoZ29hbEl0ZW0pID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdHb2FsIGRlc2NyaXB0aW9uIHVwZGF0ZWQnKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMikuZW5kKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ0dvYWwgZGVzY3JpcHRpb24gdXBkYXRlIGZhaWxlZCcpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5lbmQoKTtcbiAgICB9KTtcbiAgfVxuXG59OyJdfQ==